<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Live Stacking Plan</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background: #f8f8f8;
    }
    .floor-label {
      font-weight: bold;
      margin-top: 20px;
      margin-bottom: 4px;
    }
    .suite-row {
      display: flex;
      gap: 8px;
      margin-bottom: 6px;
    }
    .suite {
      flex: 1;
      padding: 8px;
      background: #dde6f7;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 14px;
      text-align: center;
    }
  </style>
</head>
<body>

<h2>Stacking Plan</h2>
<div id="stackingPlan">Waiting for data from Retool...</div>

<script>
  function render(suites) {
    const container = document.getElementById('stackingPlan');
    container.innerHTML = ''; // Clear previous content

    const grouped = suites.reduce((acc, item) => {
      acc[item.floor_number] = acc[item.floor_number] || [];
      acc[item.floor_number].push(item);
      return acc;
    }, {});

    const sortedFloors = Object.keys(grouped)
      .map(Number)
      .sort((a, b) => b - a);

    sortedFloors.forEach(floor => {
      const floorLabel = document.createElement('div');
      floorLabel.className = 'floor-label';
      floorLabel.textContent = `Floor ${floor}`;
      container.appendChild(floorLabel);

      const suiteRow = document.createElement('div');
      suiteRow.className = 'suite-row';

      grouped[floor].forEach(suite => {
        const div = document.createElement('div');
        div.className = 'suite';
        div.textContent = `Suite ${suite.suite}\n${suite.type || ''}\n${suite.suite_rsf || ''} RSF`;
        suiteRow.appendChild(div);
      });

      container.appendChild(suiteRow);
    });
  }

  window.addEventListener("message", (event) => {
    if (Array.isArray(event.data)) {
      render(event.data);
    } else {
      document.getElementById('stackingPlan').innerText = "Invalid data received.";
    }
  });
</script>

</body>
</html>
